#!/bin/bash


##  Need to set SELinux, but only this once
setsebool -P httpd_can_network_connect 1

##  Need to do the git checkout without asking for known hosts
echo -e "Host cvbgitlab.cle.ra.rockwell.com\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config 

##  Need to check out the contents from git
cd /tmp && git clone git@<%= node['base']['artifactory']['git_url'] %>:<%= node['base']['artifactory']['git_project'] %>/artifactory-config.git && cd -

sleep 10

##  Need to update the Artifactory config to the latest 
curl -v -k -u admin:password -X POST -H "Content-Type: application/json" -d '{"importPath" : "/tmp/artifactory-config/base"}' "https://<%= node['ipaddress'] %>:<%= node['base']['artifactory']['web_port'] %>/artifactory/api/import/system" 


